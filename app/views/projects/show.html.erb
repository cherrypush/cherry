<h1>
  <%= @project.name %>
  <%= 'ðŸŒŽ' if @project.public_access? %>
  <%= 'ðŸ”’' if @project.private_access? %>
</h1>
<div class="mb-3">Last updated <%= time_ago_in_words(@project.reports.last.created_at) %> ago</div>

<div>
  <%=
    render 'components/dropdown',
           class: 'mb-3 mr-3',
           text: @metric ? "Metric: #{@metric.name}" : 'Filter by metric',
           entries: metric_dropdown_entries(@project, @selected_owners),
           id: 'dropdown-metrics'
  %>

  <% if @selected_owners %>
    <button class="btn-light mb-3 mr-3" disabled>Filtered by <%= @selected_owners.map(&:handle).to_sentence %></button>
  <% end %>
  <% if @metric || @selected_owners %>
    <%= link_to 'Clear filters', project_path(@project), class: 'text-link' %>
  <% end %>
</div>

<% if @metric %>
  <div class="card mb-3 text-center">
    <h3 class="inline"><%= @metric.name %></h3>
    <%= area_chart @metric.chart_data(owners: @selected_owners), height: '240px' %>
  </div>
  <% if @selected_owners %>
    <div class="card prose dark:prose-invert max-w-none mb-3">
      <p class="mb-3">Use the command below to get the list of occurrences:</p>
      <pre class="mt-3">
npm install -g cherrypush
cherry run --metric="<%= @metric.name %>" --owner="<%= @selected_owners.map(&:handle).join(',') %>"</pre
      >
    </div>
  <% end %>

  <% if @metric.owners.any? %>
    <div class="overflow-x-auto relative">
      <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
        <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
          <tr>
            <th scope="col" class="py-3 px-6">Team</th>
            <th scope="col" class="py-3 px-6">Occurrences</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <% @metric.owners.each do |owner| %>
            <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700">
              <td class="py-4 px-6">
                <%= owner.handle %>
              </td>
              <td class="py-4 px-6">
                <%= owner.count %>
              </td>
              <td>
                <% if @selected_owners && @selected_owners.map(&:handle).include?(owner.handle) %>
                  <%=
                    link_to 'Remove',
                            project_path(
                              @project,
                              metric_name: @metric.name,
                              owner_handles: @selected_owners.map(&:handle) - [owner.handle],
                            ),
                            class: 'btn-light btn-sm'
                  %>
                <% else %>
                  <%=
                    link_to 'Add to filter',
                            project_path(
                              @project,
                              metric_name: @metric.name,
                              owner_handles: (@selected_owners&.map(&:handle) || []) + [owner.handle],
                            ),
                            class: 'btn-primary btn-sm'
                  %>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% end %>
<% else %>
  <% @project.metrics.each do |metric| %>
    <div class="card mb-3 text-center">
      <h3 class="inline"><%= metric.name %></h3>
      <%=
        link_to 'Filter by this metric',
                project_path(@project, metric_name: metric.name, owner_handles: @selected_owners&.map(&:handle)),
                class: 'btn-primary float-right btn-sm'
      %>
      <%= area_chart metric.chart_data(owners: @selected_owners), height: '240px' %>
    </div>
  <% end %>
<% end %>
