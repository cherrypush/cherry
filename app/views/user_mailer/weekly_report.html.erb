<div class="container">
  <p>Hi <%= @user.name.split.first %>! ðŸ‘‹</p>

  <p>Here's how your Cherry projects evolved during the last ~7 days.</p>

  <% @user.projects.each do |project| %>
    <% report = project.latest_report %>
    <% previous_report = project.reports.where('commit_date < ?', 7.days.ago).order(:commit_date).last %>
    <% next if previous_report.nil? %>

    <h3><%= link_to project.name, user_metrics_url(project_id: project.id) %></h3>
    <table>
      <thead>
        <tr>
          <td>Metric</td>
          <td style="width:10%;">Count</td>
          <td style="width:10%;">Change</td>
        </tr>
      </thead>
      <tbody>
        <% project.metrics.each do |metric| %>
          <tr>
            <td><%= link_to metric.name, user_metrics_url(project_id: project.id, metric_name: metric.name) %></td>
            <td class="text-right"><%= number_with_delimiter metric.total %></td>
            <td class="text-right">
              <%= number_to_diff(metric.total - previous_report.metrics.dig(metric.name, 'total').to_i) %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% end %>

  <p>Let's keep that codebase clean âœ¨</p>

  <p>Happy hacking!</p>

  <p>~Flavio</p>

  <div class="text-small">
    PS: To unsubscribe from future reports, just reply to this email and I'll manually shut this down for you.
  </div>
</div>

<style>
  html,
  body {
    background: #111827;
    color: #9ba3af;
    font-family: Arial, sans-serif;
  }

  .container {
    margin: 0 auto;
    max-width: 800px;
    padding: 1rem 0;
  }

  h3 {
    margin-top: 30px;
  }

  a {
    color: #3d81f5;
    text-decoration: none;
  }

  a:hover {
    text-decoration: underline;
  }

  table {
    border-collapse: collapse;
    width: 100%;
  }

  table thead td {
    background: #374151;
    text-transform: uppercase;
  }

  table,
  th,
  td {
    border: 1px solid black;
    padding: 1rem 1.5rem;
    background: #1f2937;
    color: #9ba3af;
  }

  .text-right {
    text-align: right;
  }

  .text-small {
    font-size: 0.8rem;
  }
</style>
