<p>Hi <%= @user.name.split.first %>! ðŸ‘‹</p>

<p>Here's how your projects evolved during the last ~7 days.</p>

<% @user.projects.each do |project| %>
  <% report = project.latest_report %>
  <% previous_report = project.deprecated_reports.where('commit_date < ?', 7.days.ago).order(:commit_date).last %>
  <% next if previous_report.nil? %>

  <table class="reports-table" style="margin-bottom:1.5rem;">
    <thead>
      <tr>
        <td><%= project.name %></td>
        <td style="width:10%;">Count</td>
        <td style="width:10%;">Change</td>
      </tr>
    </thead>
    <tbody>
      <% project.deprecated_metrics.each do |metric| %>
        <tr>
          <td>
            <%= link_to metric.name, user_metrics_url(project_id: project.id, metric_name: metric.name) %>
          </td>
          <td class="text-right"><%= number_with_delimiter metric.total %></td>
          <td class="text-right">
            <%= number_to_diff(metric.total - previous_report.metrics.dig(metric.name, 'total').to_i) %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% end %>

<p>Let's keep that codebase clean âœ¨</p>

<p>Happy hacking! <br />~ Flavio</p>
